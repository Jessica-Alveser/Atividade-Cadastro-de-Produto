const prompt = require('prompt-sync')({ singint: true});
 
const produtos = [];

function menu() {
    console.log("n\===== MENU ====");
    console.log("1-Cadastrar novo produto:");
    console.log("2-Listar produtos:");
    console.log("3-Buscar produto:");
    console.log("4-Total de produto em estoque:");
    console.log("0- SAIR");
    const opcao = prompt ("> ").trim();
    return opcao;
}
function cadastrarProduto() {
 const nome = prompt ("Digite o nome do produto: ");
 const preco = Number(prompt ("Digite o preço do produto: "));
 const quantidade = Number(prompt ("Digite a quantidade: "));

 if (!nome){console.log("ESTE CAMPO PRECISA SER PREENCHIDO."); return;}
 if(!Number.isFinite(preco)||preco <= 0){console.log("PREÇO INVÁLIDO.");return;}
 if(!Number.isInteger(quantidade)|| quantidade < 0){console.log("QUANTIDADE INVÁLIDA.");}

 const existente = produtos.some

 produtos.push({nome, preco , quantidade});
console.log("Produto cadastrado com suscesso!");
}
 function listarProdutos() {
   if (produtos.length === 0) { console.log("Nenhum produto cadastrado."); return;}
   console.log("# nome        preco      quantidade    subtotal ");
   produtos.forEach((p,i) => {
    const subtotal = (p.preco * p.quantidade).toFixed(2);
    console.log(String(i+1).padEnd(3), p.nome.padEnd(18), String(p.preco.toFixed(2)).padEnd(8));
   })

 }

function buscarPorNome() {
 const chave = prompt("Buscar por nome: ").trim().toLowerCase();
 const achados= produtos.filter(p => p.nome.toLowerCase().includes(chave));
  if (achados.length === 0) { console.log("Nenhum produto encontrado."); return; }
  achados.forEach(p => {
    const subtotal = (p.preco * p.quantidade).toFixed(2);
    console.log(`Encontrado: ${p.nome} (${p.preco.toFixed(2)} × ${p.quantidade} = ${subtotal})`);
  });
 }
 function totalEmEstoque() {
  const total = produtos.reduce((acc, p) => acc + p.preco * p.quantidade, 0).toFixed(2);
  console.log("Valor total em estoque: R$", total);
 }
 
 (function main() {
  console.log("Sistema de Cadastro de Produtos");
  while (true) {
    const op = menu();
    if (op === "1") cadastrarProduto();
    else if (op === "2") listarProdutos();
    else if (op === "3") buscarPorNome();
    else if (op === "4") totalEmEstoque();
    else if (op === "0") { console.log("Saindo..."); break }
    else console.log("Opção inválida");
    

  
}

 })();  
    
